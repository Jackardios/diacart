!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("diacart",[],e):"object"==typeof exports?exports.diacart=e():t.diacart=e()}(window,function(){return function(r){var a={};function i(t){if(a[t])return a[t].exports;var e=a[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,i),e.l=!0,e.exports}return i.m=r,i.c=a,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(r,a,function(t){return e[t]}.bind(null,a));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=8)}([function(t,e,r){"use strict";t.exports=r(5)},function(t,e,r){},function(t,e){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert first argument to object");for(var r=Object(t),a=1;a<arguments.length;a++){var i=arguments[a];if(null!=i)for(var n=Object.keys(Object(i)),o=0,s=n.length;o<s;o++){var c=n[o],u=Object.getOwnPropertyDescriptor(i,c);void 0!==u&&u.enumerable&&(r[c]=i[c])}}return r}})},function(t,e){var r,a;r=Element.prototype,a=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector,r.matches=r.matchesSelector=a||function(t){var e=document.querySelectorAll(t),r=this;return Array.prototype.some.call(e,function(t){return t===r})}},function(t,e,r){var a=r(0);t.exports=function(t){"use strict";t=t||{};var e="",r=a.$escape;return e+='<section class="diacart"><div class="diacart__header"><div class="diacart__title">',e+=r(t.title||""),e+='</div></div><div class="diacart__items" data-diacart-items-container></div><div class="diacart__footer"><div class="diacart__total-price">',e+=r(t.totalPriceText?t.totalPriceText+": ":""),e+='<span data-diacart-total-price-container></span></div><button class="diacart-btn diacart-btn--primary diacart-btn--medium" data-diacart-order>',e+=r(t.orderBtnText||""),e+="</button></div></section>"}},function(a,t,e){"use strict";(function(t){
/*! art-template@runtime | https://github.com/aui/art-template */
var e="undefined"==typeof window,r=Object.create(e?t:window),s=/["&'<>]/;r.$escape=function(t){return function(t){var e=""+t,r=s.exec(e);if(!r)return t;var a="",i=void 0,n=void 0,o=void 0;for(i=r.index,n=0;i<e.length;i++){switch(e.charCodeAt(i)){case 34:o="&#34;";break;case 38:o="&#38;";break;case 39:o="&#39;";break;case 60:o="&#60;";break;case 62:o="&#62;";break;default:continue}n!==i&&(a+=e.substring(n,i)),n=i+1,a+=o}return n!==i?a+e.substring(n,i):a}(function t(e){"string"!=typeof e&&(e=null==e?"":"function"==typeof e?t(e.call(e)):JSON.stringify(e));return e}(t))},r.$each=function(t,e){if(Array.isArray(t))for(var r=0,a=t.length;r<a;r++)e(t[r],r);else for(var i in t)e(t[i],i)},a.exports=r}).call(this,e(6))},function(Aa,Ba){var Ca;Ca=function(){return this}();try{Ca=Ca||Function("return this")()||eval("this")}catch(t){"object"==typeof window&&(Ca=window)}Aa.exports=Ca},function(t,e,r){var a=r(0);t.exports=function(t){"use strict";t=t||{};var e="",r=a.$escape;return e+='<div class="diacart-item" data-diamodal-item data-diacart-item-id="',e+=r(t.item.id||""),e+='"><div class="diacart-item__name">',e+=r(t.item.obj.name||""),e+="</div> ",t.item.obj.price&&(e+=' <div class="diacart-item__price">',e+=r(t.item.obj.price||""),e+="</div> "),e+=" ",t.quantitative&&(e+=' <div class="diacart-item__quantity">',e+=r(t.item.obj.quantity||""),e+="</div> "),e+=' <div class="diacart-item__buttons"><button class="diacart-item__remove-btn diacart-btn diacart-btn--medium diacart-btn--error" data-diacart-remove-from-cart data-diacart-item-id="',e+=r(t.item.id||""),e+='">',e+=r(t.removeFromCartBtnText||""),e+="</button></div></div>"}},function(t,e,r){"use strict";r.r(e);r(1),r(2),r(3);function i(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}var n=function(){function a(t){var r=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(t,e){return null};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),!t)throw new Error('Missing required parameter "name"');this._storageName=t,this._onStorageUpdate=e,window.addEventListener("storage",function(t){if(t.key===r._storageName){var e=r._storage;r._storage=JSON.parse(t.newValue||"[]"),r._onStorageUpdate(e,r._storage)}},!1)}var t,e,r;return t=a,(e=[{key:"getLastId",value:function(){var t=this.storage[this.storage.length-1];return t?t.id:0}},{key:"findByQuery",value:function(r){return r?this.storage.filter(function(t){for(var e in r)if(r[e]!==t.obj[e])return!1;return!0}):[]}},{key:"findById",value:function(e){return this.storage.find(function(t){return t.id===e}).obj}},{key:"add",value:function(t){if(!t)return null;var e=this.storage,r={id:this.getLastId()+1,obj:t};return e.push(r),this.storage=e,r}},{key:"update",value:function(t,e){if(t&&e)for(var r,a=this.storage,i=0;i<a.length;++i)if(a[i].id===t)return r=Object.assign({},a[i].obj,e),a[i].obj=r,this.storage=a,r;return null}},{key:"removeById",value:function(t){for(var e=this.storage,r=0;r<e.length;++r)if(e[r].id===t){var a=e[r];return e.splice(r,1),this.storage=e,a}return null}},{key:"removeByQuery",value:function(r){if(r){var t=this.storage.filter(function(t){for(var e in r)if(r[e]!==t.obj[e])return!0;return!1});return this.storage=t,!0}return!1}},{key:"clear",value:function(){return this.storage=[],!0}},{key:"count",value:function(){return this.storage.length}},{key:"storage",get:function(){if(!this._storage){var t=this._storage;this._storage=JSON.parse(localStorage.getItem(this._storageName)||"[]"),this._onStorageUpdate(t,this._storage)}return this._storage},set:function(t){var e=this._storage;this._storage=t,localStorage.setItem(this._storageName,JSON.stringify(this._storage)),this._onStorageUpdate(e,this._storage)}}])&&i(t.prototype,e),r&&i(t,r),a}();function o(t,e,r,a){t.addEventListener(e,function(t){for(var e=t.target;e&&e!=this;e=e.parentNode)if(e.matches(r)){a.call(e,t);break}},!1)}function s(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function c(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var u={name:"diacart",title:"Корзина покупок",totalPriceText:"Итоговая сумма",totalQuantityText:"Количество",removeFromCartBtnText:"Удалить",orderBtnText:"Оформить заказ",quantitative:!0,groupBy:"id",wrapperTemplate:r(4),itemTemplate:r(7),totalPriceTemplate:function(t){return parseFloat(t.totalPrice).toFixed(2)},totalQuantityTemplate:function(t){return parseInt(t.totalQuantity)},containerSelector:"[data-diacart-container]",totalPriceContainerSelector:"[data-diacart-total-price-container]",totalQuantityContainerSelector:"[data-diacart-total-quantity-container]",itemsContainerSelector:"[data-diacart-items-container]",itemSelector:"[data-diacart-item]",addToCartBtnSelector:"[data-diacart-add-to-cart]",removeFromCartBtnSelector:"[data-diacart-remove-from-cart]",orderBtnSelector:"[data-diacart-order]",onAdd:function(t){return t},onRemove:function(t){return t},onClear:function(t){return t},onOrder:function(t){return t}},a=function(){function r(t){var a=this;for(var e in function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),c(this,"add",function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!t&&console&&console.log&&console.log("'item' argument is undefined!"),a._options.quantitative&&(t.quantity=t.quantity&&0<t.quantity?t.quantity:1,a._options.groupBy)){var e=c({},a._options.groupBy,t[a._options.groupBy]),r=a._groupItemsByQuery(e);r?a._storage.update(r.id,{quantity:r.obj.quantity+t.quantity}):a._storage.add(t)}else a._storage.add(t),a._options.onAdd(t)}),c(this,"remove",function(t){t||new Error("'id' argument is required"),a._storage.removeById(t),a._options.onRemove(t)}),c(this,"clear",function(){a._storage.clear(),a._options.onClear()}),c(this,"order",function(){a._options.onOrder()}),c(this,"update",function(t,e){console.log("UPDATE"),a.updateTotalPrice(),a.updateTotalQuantity(),a.renderCartItems()}),c(this,"updateTotalPrice",function(){a._totalPrice=a._calculateTotalPrice(),a.renderTotalPrice()}),c(this,"updateTotalQuantity",function(){a._totalQuantity=a._calculateTotalQuantity(),a.renderTotalQuantity()}),c(this,"_itemsTemplate",function(t){var e=t.itemTemplate,r=t.items,a=t.quantitative,i=t.removeFromCartBtnText,n="";return r.forEach(function(t){n+=e({item:t,quantitative:a,removeFromCartBtnText:i})}),n}),this._options={},u)this._options[e]=t[e]||u[e];this.init()}var t,e,a;return t=r,(e=[{key:"init",value:function(){this._storage=new n(this._options.name,this.update),this._containers=document.querySelectorAll(this._options.containerSelector),this.renderCart(),this._itemsContainer=document.querySelector(this._options.itemsContainerSelector),this._totalPriceContainers=document.querySelectorAll(this._options.totalPriceContainerSelector),this._totalQuantityContainers=document.querySelectorAll(this._options.totalQuantityContainerSelector),this.renderCartItems(),this.updateTotalQuantity(),this.updateTotalPrice(),this._attachEventHandlers()}},{key:"_attachEventHandlers",value:function(){var a=this;o(document,"click",this._options.orderBtnSelector,function(){a.order()}),o(document,"click",this._options.addToCartBtnSelector,function(t){var e=t.target.getAttribute("data-diacart-item-json"),r=JSON.parse(e);a.add(r)}),this._itemsContainer&&o(this._itemsContainer,"click",this._options.removeFromCartBtnSelector,function(t){var e=parseInt(t.target.getAttribute("data-diacart-item-id"));a.remove(e)})}},{key:"_groupItemsByQuery",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(t){var e=this._storage.findByQuery(t);if(e.length){var r=e[0];if(1<e.length){for(var a=0,i=0;i<e.length;i++)e[i].obj&&(a+=e[i].obj.quantity?parseInt(e[i].obj.quantity):1);r.obj.quantity=a,this._storage.removeByQuery(t),this._storage.add(r.obj)}return r}}return null}},{key:"_calculateTotalQuantity",value:function(){var e=0;return this._options.quantitative&&this._storage.storage.forEach(function(t){e+=t.obj.quantity?parseInt(t.obj.quantity):1}),e}},{key:"_calculateTotalPrice",value:function(){var r=0;return this._options.quantitative&&this._storage.storage.forEach(function(t){var e=t.obj.quantity?parseInt(t.obj.quantity):1;r+=(t.obj.price?parseFloat(t.obj.price):0)*e}),r}},{key:"_renderTemplateToContainers",value:function(t,e,r){if(t&&t.length)for(var a=e(r),i=0;i<t.length;++i)t[i]&&(t[i].innerHTML=a)}},{key:"renderCart",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._containers,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.wrapperTemplate;this._renderTemplateToContainers(t,e,{title:this._options.title,totalPriceText:this._options.totalPriceText,totalQuantityText:this._options.totalQuantityText,totalPrice:this._totalPrice,totalQuantity:this._totalQuantity,quantitative:this._options.quantitative,removeFromCartBtnText:this._options.removeFromCartBtnText,orderBtnText:this._options.orderBtnText})}},{key:"renderCartItems",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._itemsContainer,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.itemTemplate;this._renderTemplateToContainers([t],this._itemsTemplate,{itemTemplate:e,items:this._storage.storage,quantitative:this._options.quantitative,removeFromCartBtnText:this._options.removeFromCartBtnText})}},{key:"renderTotalPrice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._totalPriceContainers,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.totalPriceTemplate;this._renderTemplateToContainers(t,e,{totalPrice:this._totalPrice})}},{key:"renderTotalQuantity",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._totalQuantityContainers,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.totalQuantityTemplate;this._renderTemplateToContainers(t,e,{totalQuantity:this._totalQuantity})}}])&&s(t.prototype,e),a&&s(t,a),r}();e.default=a}])});