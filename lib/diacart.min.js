!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("diacart",[],e):"object"==typeof exports?exports.diacart=e():t.diacart=e()}(window,function(){return function(r){var i={};function a(t){if(i[t])return i[t].exports;var e=i[t]={i:t,l:!1,exports:{}};return r[t].call(e.exports,e,e.exports,a),e.l=!0,e.exports}return a.m=r,a.c=i,a.d=function(t,e,r){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)a.d(r,i,function(t){return e[t]}.bind(null,i));return r},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=9)}([function(t,e,r){"use strict";t.exports=r(6)},function(t,e,r){},function(t,e){Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert first argument to object");for(var r=Object(t),i=1;i<arguments.length;i++){var a=arguments[i];if(null!=a)for(var n=Object.keys(Object(a)),o=0,s=n.length;o<s;o++){var c=n[o],u=Object.getOwnPropertyDescriptor(a,c);void 0!==u&&u.enumerable&&(r[c]=a[c])}}return r}})},function(t,e){var r,i;r=Element.prototype,i=r.matches||r.matchesSelector||r.webkitMatchesSelector||r.mozMatchesSelector||r.msMatchesSelector||r.oMatchesSelector,r.matches=r.matchesSelector=i||function(t){var e=document.querySelectorAll(t),r=this;return Array.prototype.some.call(e,function(t){return t===r})}},function(t,e){Element.prototype.closest||(Element.prototype.closest=function(t){return this?this.matches(t)?this:this.parentElement?this.parentElement.closest(t):null:null})},function(t,e,r){var i=r(0);t.exports=function(t){"use strict";t=t||{};var e="",r=i.$escape;return e+='<div class="diacart-wrapper"><section class="diacart"><div class="diacart__header"><div class="diacart__title">',e+=r(t.title||""),e+='</div></div><div class="diacart__items" data-diacart-items-container></div><div class="diacart__footer"><div class="diacart__footer-container"><div class="diacart__total-price">',e+=r(t.totalPriceText?t.totalPriceText+": ":""),e+='<span data-diacart-total-price-container></span></div><button class="diacart__order-btn diacart-btn diacart-btn--primary diacart-btn--medium" data-diacart-order>',e+=r(t.orderBtnText||""),e+="</button></div></div></section></div>"}},function(i,t,e){"use strict";(function(t){
/*! art-template@runtime | https://github.com/aui/art-template */
var e="undefined"==typeof window,r=Object.create(e?t:window),s=/["&'<>]/;r.$escape=function(t){return function(t){var e=""+t,r=s.exec(e);if(!r)return t;var i="",a=void 0,n=void 0,o=void 0;for(a=r.index,n=0;a<e.length;a++){switch(e.charCodeAt(a)){case 34:o="&#34;";break;case 38:o="&#38;";break;case 39:o="&#39;";break;case 60:o="&#60;";break;case 62:o="&#62;";break;default:continue}n!==a&&(i+=e.substring(n,a)),n=a+1,i+=o}return n!==a?i+e.substring(n,a):i}(function t(e){"string"!=typeof e&&(e=null==e?"":"function"==typeof e?t(e.call(e)):JSON.stringify(e));return e}(t))},r.$each=function(t,e){if(Array.isArray(t))for(var r=0,i=t.length;r<i;r++)e(t[r],r);else for(var a in t)e(t[a],a)},i.exports=r}).call(this,e(7))},function(Da,Ea){var Fa;Fa=function(){return this}();try{Fa=Fa||Function("return this")()||eval("this")}catch(t){"object"==typeof window&&(Fa=window)}Da.exports=Fa},function(t,e,r){var i=r(0);t.exports=function(t){"use strict";t=t||{};var e="",r=i.$escape;return e+='<div class="diacart-item" data-diamodal-item data-diacart-item-id="',e+=r(t.item.id||""),e+='"><div class="diacart-grid"> ',t.item.obj.image&&(e+=' <div class="diacart-grid-col diacart-grid-col--v-gutter diacart-grid-col--auto diacart-item__image-col"><a href="',e+=r(t.item.obj.link||""),e+='" class="diacart-item__image-container"><img src="',e+=r(t.item.obj.image||""),e+='" alt="',e+=r(t.item.obj.name||""),e+='" class="diacart-item__image"></a></div> '),e+=' <div class="diacart-grid-col diacart-grid-col--v-gutter diacart-grid-col--flex diacart-item__text-col"> ',t.itemHasPrice&&t.item.obj.price&&(e+=' <div class="diacart-item__price">',e+=r(t.item.obj.price||""),e+=r(t.currency||""),e+="</div> "),e+=' <a href="',e+=r(t.item.obj.link||""),e+='" class="diacart-item__title">',e+=r(t.item.obj.name||""),e+="</a> ",t.itemHasQuantity&&t.item.obj.quantity&&(e+=' <div class="diacart-item__quantity diacart-counter"><div class="diacart-counter__container diacart-grid diacart-grid--no-gutter"><button class="diacart-grid__col diacart-grid__col--auto diacart-counter__btn diacart-counter__plus-btn">+</button> <input class="diacart-grid__col diacart-grid__col--flex diacart-counter__input" type="number" name="quantity" data-diacart-quantity-input data-diacart-item-id="',e+=r(t.item.id||""),e+='" value="',e+=r(t.item.obj.quantity||1),e+='"> <button class="diacart-grid__col diacart-grid__col--auto diacart-counter__btn diacart-counter__minus-btn">-</button></div></div> '),e+=' <button class="diacart-item__remove-btn" data-diacart-remove-from-cart data-diacart-item-id="',e+=r(t.item.id||""),e+='">',e+=t.removeFromCartBtnText||"",e+="</button></div></div></div>"}},function(t,e,r){"use strict";r.r(e);r(1),r(2),r(3),r(4);function a(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var n=function(){function i(t){var r=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(t,e){return null};if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,i),!t)throw new Error('Missing required parameter "name"');this._storageName=t,this._onStorageUpdate=e,window.addEventListener("storage",function(t){if(t.key===r._storageName){var e=r._storage;r._storage=JSON.parse(t.newValue||"[]"),r._onStorageUpdate(e,r._storage)}},!1)}var t,e,r;return t=i,(e=[{key:"getLastId",value:function(){var t=this.storage[this.storage.length-1];return t?t.id:0}},{key:"findByQuery",value:function(r){return r?this.storage.filter(function(t){for(var e in r)if(r[e]!==t.obj[e])return!1;return!0}):[]}},{key:"findById",value:function(e){return this.storage.find(function(t){return t.id===e}).obj}},{key:"add",value:function(t){if(!t)return null;var e=this.storage,r={id:this.getLastId()+1,obj:t};return e.push(r),this.storage=e,r}},{key:"update",value:function(t,e){if(t&&e)for(var r,i=this.storage,a=0;a<i.length;++a)if(i[a].id===t)return r=Object.assign({},i[a].obj,e),i[a].obj=r,this.storage=i,r;return null}},{key:"removeById",value:function(t){for(var e=this.storage,r=0;r<e.length;++r)if(e[r].id===t){var i=e[r];return e.splice(r,1),this.storage=e,i}return null}},{key:"removeByQuery",value:function(r){if(r){var t=this.storage.filter(function(t){for(var e in r)if(r[e]!==t.obj[e])return!0;return!1});return this.storage=t,!0}return!1}},{key:"clear",value:function(){return this.storage=[],!0}},{key:"count",value:function(){return this.storage.length}},{key:"storage",get:function(){if(!this._storage){var t=this._storage;this._storage=JSON.parse(localStorage.getItem(this._storageName)||"[]"),this._onStorageUpdate(t,this._storage)}return this._storage},set:function(t){var e=this._storage;this._storage=t,localStorage.setItem(this._storageName,JSON.stringify(this._storage)),this._onStorageUpdate(e,this._storage)}}])&&a(t.prototype,e),r&&a(t,r),i}();function o(t,e,r,i){var a=4<arguments.length&&void 0!==arguments[4]&&arguments[4];t.addEventListener(e,function(t){for(var e=t.target;e&&e!=this;e=e.parentNode)if(e.matches(r)){i.call(e,t);break}},a)}function s(t,e){var r;document.createEvent?(r=document.createEvent("HTMLEvents")).initEvent(e,!0,!0):(r=document.createEventObject()).eventType=e,r.eventName=e,document.createEvent?t.dispatchEvent(r):t.fireEvent("on"+r.eventType,r)}var c={wrapper:".diacart-counter",buttonPlus:".diacart-counter__plus-btn",buttonMinus:".diacart-counter__minus-btn",input:".diacart-counter__input"};function u(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function l(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var d={name:"diacart",title:"Корзина покупок",totalPriceText:"Итоговая сумма",totalQuantityText:"Количество",removeFromCartBtnText:"",emptyCartText:'<div class="diacart-empty"><h2 class="diacart-empty__title">Ваша корзина пуста</h2></div>',orderBtnText:"Оформить заказ",currency:"р.",groupBy:"id",itemHasQuantity:!0,itemHasPrice:!0,itemCustomFields:[],wrapperTemplate:r(5),itemTemplate:r(8),totalPriceTemplate:function(t){return parseFloat(t.totalPrice).toFixed(2)+(t.currency||"")},totalQuantityTemplate:function(t){return parseInt(t.totalQuantity)},containerSelector:"[data-diacart-container]",totalPriceContainerSelector:"[data-diacart-total-price-container]",totalQuantityContainerSelector:"[data-diacart-total-quantity-container]",itemsContainerSelector:"[data-diacart-items-container]",itemSelector:"[data-diacart-item]",addToCartBtnSelector:"[data-diacart-add-to-cart]",removeFromCartBtnSelector:"[data-diacart-remove-from-cart]",quantityInputSelector:"[data-diacart-quantity-input]",orderBtnSelector:"[data-diacart-order]",onInit:function(t){return t},onAdd:function(t){return t},onUpdate:function(t){return t},onRemove:function(t){return t},onClear:function(t){return t},onOrder:function(t){return t}},i=function(){function e(t){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),l(this,"add",function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!t&&console&&console.log)console.log("'item' argument is undefined!");else{if(i._options.itemHasQuantity&&(t.quantity=t.quantity&&0<t.quantity?t.quantity:1,i._options.groupBy)){var e=l({},i._options.groupBy,t[i._options.groupBy]),r=i._groupItemsByQuery(e);return r?i._storage.update(r.id,{quantity:r.obj.quantity+t.quantity}):i._storage.add(t),void i._options.onAdd(t)}i._storage.add(t),i._options.onAdd(t)}}),l(this,"update",function(t,e){i._storage.update(t,e),i._options.onUpdate()}),l(this,"remove",function(t){t||new Error("'id' argument is required"),i._storage.removeById(t),i._options.onRemove(t)}),l(this,"clear",function(){i._storage.clear(),i._options.onClear()}),l(this,"order",function(){i._options.onOrder()}),l(this,"refresh",function(t,e){i.refreshTotalPrice(),i.refreshTotalQuantity(),i.renderCartItems()}),l(this,"refreshTotalPrice",function(){i._totalPrice=i._calculateTotalPrice(),i.renderTotalPrice()}),l(this,"refreshTotalQuantity",function(){i._totalQuantity=i._calculateTotalQuantity(),i.renderTotalQuantity()}),l(this,"_itemsTemplate",function(e){var r="";return e.items&&e.items.length?e.items.forEach(function(t){e.item=t,r+=e.itemTemplate(e)}):r+=e.emptyCartText,r}),this._options=Object.assign({},d,t),this.init()}var t,r,i;return t=e,(r=[{key:"init",value:function(){this._storage=new n(this._options.name,this.refresh),this._containers=document.querySelectorAll(this._options.containerSelector),this.renderCart(),this._itemsContainer=document.querySelector(this._options.itemsContainerSelector),this._totalPriceContainers=document.querySelectorAll(this._options.totalPriceContainerSelector),this._totalQuantityContainers=document.querySelectorAll(this._options.totalQuantityContainerSelector),this.renderCartItems(),this.refreshTotalQuantity(),this.refreshTotalPrice(),this._attachEventHandlers(),this._options.onInit(this),function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:document,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:c;t&&(o(t,"click",i.buttonPlus,function(){var t=this.closest(i.wrapper).querySelector(i.input),e=parseInt(t.value),r=-1<e?e+1:1;t.value=r,s(t,"change")}),o(t,"click",i.buttonMinus,function(){var t=this.closest(i.wrapper).querySelector(i.input),e=parseInt(t.value),r=1<e?e-1:e;t.value=r,s(t,"change")}))}(this._itemsContainer)}},{key:"_attachEventHandlers",value:function(){var i=this,a=this;if(o(document,"click",this._options.orderBtnSelector,function(t){t.preventDefault(),i.order()},!0),o(document,"click",this._options.addToCartBtnSelector,function(t){t.preventDefault();var e=this.getAttribute("data-diacart-item-json"),r=JSON.parse(e);a.add(r)},!0),this._itemsContainer){o(this._itemsContainer,"click",this._options.removeFromCartBtnSelector,function(t){if(t.preventDefault(),this){var e=parseInt(this.getAttribute("data-diacart-item-id"));a.remove(e)}},!0);var e,r=function(t){if(t.target){var e=parseInt(t.target.getAttribute("data-diacart-item-id"));if(t.target.value){var r=parseInt(t.target.value);0<r&&(t.target.blur(),i.update(e,{quantity:r}))}}};o(this._itemsContainer,"change",this._options.quantityInputSelector,r),o(this._itemsContainer,"keyup",this._options.quantityInputSelector,function(t){clearTimeout(e),e=setTimeout(function(){return r(t)},300)})}}},{key:"_groupItemsByQuery",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(t){var e=this._storage.findByQuery(t);if(e.length){var r=e[0];if(1<e.length){for(var i=0,a=0;a<e.length;a++)e[a].obj&&(i+=e[a].obj.quantity?parseInt(e[a].obj.quantity):1);r.obj.quantity=i,this._storage.removeByQuery(t),this._storage.add(r.obj)}return r}}return null}},{key:"_calculateTotalQuantity",value:function(){var e=this,r=0;return this._options.itemHasQuantity&&this._storage.storage.forEach(function(t){r+=e._options.itemHasQuantity&&t.obj.quantity?parseInt(t.obj.quantity):1}),r}},{key:"_calculateTotalPrice",value:function(){var r=this,i=0;return this._options.itemHasPrice&&this._storage.storage.forEach(function(t){var e=r._options.itemHasQuantity&&t.obj.quantity?parseInt(t.obj.quantity):1;i+=(t.obj.price?parseFloat(t.obj.price):0)*e}),i}},{key:"_renderTemplateToContainers",value:function(t,e,r){if(t&&t.length)for(var i=e(r),a=0;a<t.length;++a)t[a]&&(t[a].innerHTML=i)}},{key:"renderCart",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._containers,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.wrapperTemplate;this._renderTemplateToContainers(t,e,{title:this._options.title,totalPriceText:this._options.totalPriceText,totalQuantityText:this._options.totalQuantityText,totalPrice:this._totalPrice,totalQuantity:this._totalQuantity,itemHasPrice:this._options.itemHasPrice,itemHasQuantity:this._options.itemHasQuantity,orderBtnText:this._options.orderBtnText})}},{key:"renderCartItems",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._itemsContainer,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.itemTemplate;this._renderTemplateToContainers([t],this._itemsTemplate,{itemTemplate:e,items:this._storage.storage,currency:this._options.currency,itemHasPrice:this._options.itemHasPrice,itemHasQuantity:this._options.itemHasQuantity,itemCustomFields:this._options.itemCustomFields,emptyCartText:this._options.emptyCartText,removeFromCartBtnText:this._options.removeFromCartBtnText})}},{key:"renderTotalPrice",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._totalPriceContainers,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.totalPriceTemplate;this._renderTemplateToContainers(t,e,{totalPrice:this._totalPrice,currency:this._options.currency})}},{key:"renderTotalQuantity",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._totalQuantityContainers,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this._options.totalQuantityTemplate;this._renderTemplateToContainers(t,e,{totalQuantity:this._totalQuantity})}}])&&u(t.prototype,r),i&&u(t,i),e}();e.default=i}])});